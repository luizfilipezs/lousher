!function e(t,s,r){function i(o,d){if(!s[o]){if(!t[o]){var a="function"==typeof require&&require;if(!d&&a)return a(o,!0);if(n)return n(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=s[o]={exports:{}};t[o][0].call(l.exports,(function(e){return i(t[o][1][e]||e)}),l,l.exports,e,t,s,r)}return s[o].exports}for(var n="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const r=e("./exceptions"),i=e("./utils");s.default=class{constructor(e,t=!0){this.routes=e,t&&document.addEventListener("DOMContentLoaded",()=>this.init())}init(){this.defineView(),this.view.getItems()}defineView(){const e=i.removeFileExtension(window.location.pathname,".html"),t=this.routes.find(t=>"/"+t.path===e);if(!t)throw new r.UndefinedRouteError;this.view=new t.view}}},{"./exceptions":2,"./utils":8}],2:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.UndefinedRouteError=void 0;class r extends Error{constructor(){super(`"${window.location.pathname}" is not defined in routes`),this.name="UndefinedRouteError"}}s.UndefinedRouteError=r},{}],3:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const r=e("./app"),i=e("./routes");new r.default(i.appRoutes)},{"./app":1,"./routes":6}],4:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const r=e("./services");s.default=class{constructor(){this.items=[],this.orderBy="newer",this.iterateOrder=this.orderParameter(),this.http=r.mensagemService,this.DOM={listSelector:document.querySelector(".items-list"),orderListButton:document.getElementById("order-by"),refreshButton:document.getElementById("refresh"),sendEmailButton:document.getElementById("send-mail"),responseMessage:document.getElementById("response-text"),errorMessageMask:document.getElementById("mask")},this.addListeners()}addListeners(){this.DOM.orderListButton.addEventListener("click",()=>{this.reorderItems(),this.DOM.orderListButton.textContent=["Mais recentes","Mais antigas","Não lidas"][["newer","older","unread"].indexOf(this.orderBy)]}),this.DOM.refreshButton.addEventListener("click",()=>this.getItems()),this.DOM.errorMessageMask.addEventListener("click",()=>this.DOM.errorMessageMask.style.display="none"),this.DOM.sendEmailButton.addEventListener("click",()=>this.sendEmail())}emitError(e){const t=document.querySelector("[errorMessage]");t&&(t.textContent=e,this.DOM.errorMessageMask.style.display="flex")}getItems(){this.DOM.refreshButton.style.opacity="0.4",this.http.get().then(e=>{this.items=e,this.renderList()},e=>this.emitError("Erro ao tentar obter as mensagens!")).finally(()=>this.DOM.refreshButton.style.opacity="1")}makeRead(){this.http.patch({lido:!0},this.selectedItem.id).then(e=>{for(const t in e)this.selectedItem[t]=e[t];const t=document.getElementById(this.selectedItem.id.toString()).querySelector(".item-status");t.classList.contains("unread")&&(t.classList.remove("unread"),t.classList.add("read"))},e=>this.emitError("Erro ao tentar atualizar status da mensagem!"))}selectItem(e){this.selectedItem=this.items.find(t=>t.id===+e.id),this.selectedItem.lido||this.makeRead(),this.renderList(),this.renderSelectedOne()}renderList(){this.orderItems(),this.DOM.listSelector.innerHTML="";const e=e=>{let t="list-item";return this.selectedItem&&e.id===this.selectedItem.id&&(t+=" selected-item"),t};this.items.forEach(t=>this.DOM.listSelector.innerHTML+=`\n        <div class="${e(t)}" id="${t.id}">\n          <p class="item-description">\n            ${t.nome}, em ${t.data_envio}\n          </p>\n          <p class="item-status ${t.lido?"read":"unread"}"></p>\n        </div>\n      `),[...this.DOM.listSelector.children].forEach(e=>e.addEventListener("click",()=>this.selectItem(e)))}orderItems(){switch(this.orderBy){case"newer":this.items.sort((e,t)=>t.id-e.id);break;case"older":this.items.sort((e,t)=>e.id-t.id);break;case"unread":this.items.sort((e,t)=>!e.lido&&t.lido?-1:e.lido&&!t.lido?1:0)}}*orderParameter(){for(;;)for(const e of["older","unread","newer"])yield this.orderBy=e}reorderItems(){this.iterateOrder.next(),this.orderItems(),this.renderList()}renderSelectedOne(){document.querySelectorAll("[bind]").forEach(e=>{const t=e.getAttribute("bind");t&&this.selectedItem[t]&&(e.textContent=this.selectedItem[t])});document.querySelectorAll("[invisibleUntil]").forEach(e=>{"open-content"===e.getAttribute("invisibleUntil")&&(e.style.visibility="visible")}),this.DOM.responseMessage.value=""}sendEmail(){const e=this.DOM.responseMessage,t=+e.getAttribute("minlength");e.value.length>=t?r.httpService.request({url:"email/response/",method:"post",obj:{messageId:this.selectedItem.id,text:e.value}}).then(t=>{this.emitError("Resposta enviada com sucesso!"),e.value=""},e=>this.emitError("Falha ao enviar o email. Tente novamente mais tarde.")):this.emitError("Verifique se a mensagem contém pelo menos 50 caracteres.")}}},{"./services":7}],5:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const r=e("./services"),i=e("./utils");s.default=class{constructor(){this.items=[],this.http=r.pedidoService,this.orderBy="newer",this.iterateOrder=this.orderParameter(),this.DOM={listSelector:document.querySelector(".items-list"),orderListButton:document.getElementById("order-by"),refreshButton:document.getElementById("refresh"),errorMessageMask:document.getElementById("mask"),updateStatusButton:document.getElementById("update-status-btn"),productsList:document.getElementById("products-list-wrapper")},this.addListeners()}addListeners(){this.DOM.orderListButton.addEventListener("click",()=>{this.reorderItems(),this.DOM.orderListButton.textContent=["Mais recentes","Mais antigas","Não lidas"][["newer","older","unread"].indexOf(this.orderBy)]}),this.DOM.refreshButton.addEventListener("click",()=>this.getItems()),this.DOM.updateStatusButton.addEventListener("click",()=>this.updateStatus()),this.DOM.errorMessageMask.addEventListener("click",()=>this.DOM.errorMessageMask.style.display="none")}emitError(e){const t=document.querySelector("[errorMessage]");t&&(t.textContent=e,this.DOM.errorMessageMask.style.display="flex")}getItems(){this.DOM.refreshButton.style.opacity="0.4",this.http.get().then(e=>{this.items=e,this.renderList()},e=>this.emitError("Erro ao tentar obter os pedidos!")).finally(()=>this.DOM.refreshButton.style.opacity="1")}updateStatus(){const e=this.selectedItem.id;let t=i.removeSpecialChars(this.selectedItem.status);"em analise"===t?t="analise":"preparando envio"===t&&(t="preparando"),this.http.patch({status:t},e).then(s=>{const r=document.getElementById(e.toString()),i=document.createElement("p"),n=["em-analise","preparando-envio","despachado","suspenso","cancelado","entregue"];switch(r.querySelector(".item-status").remove(),t=s.status,i.classList.add("item-status"),t){case"analise":i.classList.add(n[0]),i.innerHTML="em análise";break;case"preparando":i.classList.add(n[1]),i.innerHTML="preparando envio";break;default:i.classList.add(n.find(e=>e===t)),i.innerHTML=t}r.appendChild(i)},t=>this.emitError(`Erro ao tentar atualizar o status do pedido #${e}!`))}renderList(){this.orderItems(),this.DOM.listSelector.innerHTML="";const e=e=>{let t="list-item";return this.selectedItem&&e.id===this.selectedItem.id&&(t+=" selected-item"),t};this.items.forEach(t=>{return this.DOM.listSelector.innerHTML+=`\n        <div class="${e(t)}" id="${t.id}">\n          <p class="item-description">\n            ${t.endereco.nome_destinatario}, em ${t.data_pedido}\n          </p>\n          <p class="item-status ${s=t.status,i.removeSpecialChars(s).replace(/ /g,"-")}">${t.status}</p>\n        </div>\n      `;var s}),[...this.DOM.listSelector.children].forEach(e=>e.addEventListener("click",()=>this.selectItem(e)))}selectItem(e){this.selectedItem=this.items.find(t=>t.id===+e.id),this.renderSelectedOne(),this.getOrderProducts()}renderSelectedOne(){const e=this.selectedItem,t=e.endereco,s={id:e.id,nome:t.nome_destinatario,data_pedido:e.data_pedido,mensagem:e.observacoes,...this.formatAddress(e.endereco)},r=document.querySelectorAll("[bind]"),i=document.querySelectorAll(".list-item"),n=document.querySelectorAll(".status-box"),o=document.querySelector(".open-content");"open-content"===o.getAttribute("invisibleUntil")&&(o.style.visibility="visible"),r.forEach(e=>{const t=e.getAttribute("bind");t&&s[t]&&(e.textContent=s[t])});const d=()=>n.forEach(e=>{const t="selected-status";e.textContent===this.selectedItem.status?e.classList.add(t):e.classList.contains(t)&&e.classList.remove(t)});d(),n.forEach(e=>e.addEventListener("click",()=>{this.selectedItem.status=e.textContent,d()})),i.forEach(e=>{e.id===this.selectedItem.id.toString()?e.classList.contains("selected-item")||e.classList.add("selected-item"):e.classList.contains("selected-item")&&e.classList.remove("selected-item")})}formatAddress(e){return{cidade:e.cidade+" - "+e.uf,rua:e.rua+", "+e.numero+(e.complemento?", "+e.complemento:""),bairro:"Bairro "+e.bairro+", "+e.cep,destinatario:"Entregar a "+e.nome_destinatario}}getOrderProducts(){this.DOM.productsList.innerHTML="";const e=this.selectedItem.id;this.http.getItems(e).then(t=>{t.length&&t[0].pedido===e&&t.forEach(e=>{const t=e.produto.preco_oferta||e.produto.preco,s=e.produto.nome+" x "+e.qntd+", R$"+t+"/unidade";this.DOM.productsList.innerHTML+='<p class="products-list-item">'+s+"</p>"})},t=>this.emitError(`Erro ao tentar obter lista de produtos referentes ao pedido número ${e}!`))}orderItems(){"newer"===this.orderBy?this.items.sort((e,t)=>t.id-e.id):"older"===this.orderBy&&this.items.sort((e,t)=>e.id-t.id)}*orderParameter(){for(;;)yield this.orderBy="older",yield this.orderBy="newer"}reorderItems(){this.iterateOrder.next(),this.orderItems(),this.renderList()}}},{"./services":7,"./utils":8}],6:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.appRoutes=void 0;const r=e("./messages.view"),i=e("./pedidos.view");s.appRoutes=[{path:"mensagens",view:r.default},{path:"pedidos",view:i.default}]},{"./messages.view":4,"./pedidos.view":5}],7:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.httpService=s.mensagemService=s.pedidoService=void 0;const r=e("http-service-ts"),i=e("./utils"),n={headers:new Headers({Accept:"application/json","Content-Type":"application/json","X-CSRFToken":i.Cookies.get("csrftoken")}),appendSlash:!0};class o extends r.Service{constructor(){super("/api/".concat("pedidos"),n)}getItems(e){return this.request({url:e+"/itens",method:"get"})}}s.pedidoService=new o,s.mensagemService=new r.Service("/api/".concat("mensagens"),n),s.httpService=new r.RequestParser("/api/",n)},{"./utils":8,"http-service-ts":9}],8:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Cookies=s.removeSpecialChars=s.removeFileExtension=s.randomDate=s.randomValueBetween=s.getRandomValueFromArray=void 0,s.getRandomValueFromArray=e=>e[~~(Math.random()*e.length)],s.randomValueBetween=(e,t)=>Math.random()*(t-e)+e,s.randomDate=(e,t)=>{e=e||"01-01-1970",t=t||(new Date).toLocaleDateString();return(e=new Date(e).getTime())>(t=new Date(t).getTime())?new Date(s.randomValueBetween(t,e)).toLocaleDateString():new Date(s.randomValueBetween(e,t)).toLocaleDateString()},s.removeFileExtension=(e,t)=>{const s=t=>{const s=e.endsWith(t);if(s){const s=e.indexOf(t);e=e.substring(0,s)}return s};if(Array.isArray(t))for(const e of t){if(s(e))break}else s(t);return e},s.removeSpecialChars=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"");s.Cookies=class{static set(e,t,s){var r=new Date;r.setTime(r.getTime()+24*s*60*60*1e3);var i="expires="+r.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}static get(e){for(var t=e+"=",s=document.cookie.split(";"),r=0;r<s.length;r++){for(var i=s[r];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}}},{}],9:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const r=e("./service");s.Service=r.default;const i=e("./request.parser");s.RequestParser=i.default},{"./request.parser":10,"./service":11}],10:[function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{a(r.next(e))}catch(e){n(e)}}function d(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,d)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(s,"__esModule",{value:!0});s.default=class{constructor(e,t){this.root=e,this.hasSlash=(e,t)=>t?e.endsWith("/")||t.startsWith("/"):e.endsWith("/"),this.config=t||{headers:new Headers,appendSlash:!1}}request(e){return r(this,void 0,void 0,(function*(){let t="";if(this.root&&(t=this.root),this.root&&e.url&&(t+=this.hasSlash(this.root,e.url)?e.url:"/"+e.url),!this.root&&e.url&&(t=e.url),this.config.appendSlash&&!this.hasSlash(t)&&(t+="/"),e.id&&(t+=this.config.appendSlash?e.id+"/":e.id.toString()),e.params){t.endsWith("/")&&(t=t.substring(0,t.length-1)),t+="?";for(const s in e.params)t+=`${s}=${e.params[s]}&`;t=t.substring(0,t.length-1)}const s={method:e.method,headers:e.headers||this.config.headers,mode:!0===e.noCors?"no-cors":"cors"};"get"!==e.method&&e.obj&&(s.body=JSON.stringify(e.obj));const r=yield fetch(t,s);return this.parse(r)}))}parse(e){return r(this,void 0,void 0,(function*(){let t;const s=e.headers.get("content-type");return t="application/json"===s?yield e.json():s&&s.startsWith("text")?yield e.text():s?yield e.blob():null,new Promise((s,r)=>e.status>=200&&e.status<300?s(t):r(t))}))}}},{}],11:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const r=e("./request.parser");class i extends r.default{constructor(e,t){super(e,t)}get(){return this.request({method:"get"})}getById(e){return this.request({method:"get",id:e})}post(e){return this.request({method:"post",obj:e})}put(e,t){return this.request({method:"put",obj:e,id:t})}patch(e,t){return this.request({method:"patch",obj:e,id:t})}delete(e){return this.request({method:"delete",id:e})}}s.default=i},{"./request.parser":10}]},{},[3]);
